<!DOCTYPE HTML>
<!--
-->

<%
    response.addHeader("Access-Control-Allow-Origin", "*");

%>
<html>
	<head>
		<title>Movie Site</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link href='http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700,800,900' rel='stylesheet' type='text/css'>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-panels.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel-noscript.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-desktop.css" />
		</noscript>
	</head><body class="homepage">
	<div id="header-wrapper">
		<div id="header">
			<div class="container">
				<div id="logo"> <!-- Logo -->
					<h1><a href="#">Movies</a></h1>
					<p></p>
				</div>
			</div>
			<div class="container">
				<nav id="nav">
					<ul>
						<!--<li class="current_page_item"><a href="index.html">Homepage</a></li>
						<li><a href="threecolumn.html">Three Column</a></li>
						<li><a href="twocolumn1.html">Two Column #1</a></li>
						<li><a href="twocolumn2.html">Two Column #2</a></li>
						<li><a href="onecolumn.html">One Column</a></li>-->
					</ul>
				</nav>
			</div>
		</div>
	</div>
	<div id="wrapper">
		<div class="container">
			<div class="row">
				<div id="banner" class="12u">
					<div class="container"><a href="#"><img src="images/pics02.jpg" alt=""></a></div>
				</div>
			</div>
		</div>
		<div id="marketing">
			<div class="container">
				<div class="row divider">
					<div class="3u">
						<section>
							<div class="mbox-style">
								<h2 class="title">Toy Story (1995)</h2>
								<div id="movie1" class="content">
								<p> </p>
									<input class="messageCheckbox1" type="checkbox" name="rate1" value="1"> 1
								     	<input class="messageCheckbox1" type="checkbox" name="rate1" value="2" > 2
								    	 <input class="messageCheckbox1" type="checkbox" name="rate1" value="3"> 3
								    	 <input class="messageCheckbox1" type="checkbox" name="rate1" value="4" > 4
								     	<input class="messageCheckbox1" type="checkbox" name="rate1" value="5">5
									<button id="ratemovie1" onclick="enterRatesM1()" type="button" value="Submit">Rate
								</div>
								<p class="button-style2"><a href="#">More Details</a></p>
							</div>
						</section>
					</div>
					<div class="3u">
						<section>
							<div class="mbox-style">
								<h2 class="title">Jumanji (1995)</h2>
								<div class="content">
									<input class="messageCheckbox2" type="checkbox" name="rate2" value="1"> 1
								     	<input class="messageCheckbox2" type="checkbox" name="rate2" value="2" > 2
								    	 <input class="messageCheckbox2"  type="checkbox" name="rate2" value="3"> 3
								    	 <input class="messageCheckbox2"  type="checkbox" name="rate2" value="4" > 4
								     	<input class="messageCheckbox2"  type="checkbox" name="rate2" value="5">5
									<button id="ratemovie2" onclick="enterRatesM2()" type="button" value="Submit">Rate

								</div>
								<p class="button-style2"><a href="#">More Details</a></p>
							</div>
						</section>
					</div>
					<div class="3u">
						<section>
							<div class="mbox-style">
								<h2 class="title">Grumpier Old Men (1995)</h2>
								<div class="content">
									 <input class="messageCheckbox3" type="checkbox" name="rate3" value="1"> 1
								     	<input class="messageCheckbox3" type="checkbox" name="rate3" value="2"> 2
								    	 <input class="messageCheckbox3"  type="checkbox" name="rate3" value="3"> 3
								    	 <input class="messageCheckbox3"  type="checkbox" name="rate3" value="4"> 4
								     	<input class="messageCheckbox3"  type="checkbox" name="rate3" value="5">5
									<button id="ratemovie3" onclick="enterRatesM3()" type="button" value="Submit">Rate
								</div>
								<p class="button-style2"><a href="#">More Details</a></p>
							</div>
						</section>
					</div>
					<div class="3u">
						<section>
							<div class="mbox-style">
								<h2 class="title">Waiting to Exhale-- Jungle Fever (1995)</h2>
								<div class="content">
									<input class="messageCheckbox4"  type="checkbox" name="rate4" value="1"> 1
								     	<input class="messageCheckbox4"   type="checkbox" name="rate4" value="2"> 2
								    	 <input class="messageCheckbox4"   type="checkbox" name="rate4" value="3"> 3
								    	 <input class="messageCheckbox4"   type="checkbox" name="rate4" value="4"> 4
								     	<input class="messageCheckbox4"   type="checkbox" name="rate4" value="5">5
									<button id="ratemovie4" onclick="enterRatesM4()" type="button" value="Submit">Rate
								</div>
								<p class="button-style2"><a href="#">More Details</a></p>
							</div>
						</section>
					</div>
		

					
				</div>
			</div>
		</div>
		<div id="page">
			<div class="container">
				<div class="row">
					<div class="3u">
						<div id="sidebar2">
							<section>
								<div class="sbox1">
									<h2>Recommended Movies</h2>
									<ul class="style1">
										<li id ="rec" class="first"><a href="#"></a></li>
									</ul>
								</div>
							</section>
							<section>
								<div class="sbox2">
									<h2>------</h2>
									<ul class="style1">
										
									</ul>
								</div>
							</section>
						</div>
					</div>
					<div class="6u">
						<div class="skel-cell-important" id="content">
							<section>
								<div class="post">
									<h2>---------</h2><a href="#"><img src="images/pics03.jpg" alt=""></a>
									<p class="button-style3"><a href="#">------</a></p>
								</div>
							</section>
						</div>
					</div>
						
					</div>
				</div>
			</div>
		</div>
		<div id="footer-wrapper">
			<div class="container">
				<div class="row" id="footer-content">
					<div class="3u" id="box1">
				</div>		
			</div>
		</div>
		<div>
			<div class="container" id="copyright">
				
			</div>
		</div>
		
		<script src="js/login.js"></script>
		<script src="js/jquery-1.11.3.min.js"></script>
		<script type="text/javascript">

		var userId = sessionStorage.getItem('userId');	
		alert("id:"+userId);
		var serverUrl = window.location.origin;

		var latestId;

		//Rate for each movie
		var rates = [];

		//Movie titles
		var movies =[];

		latestId = getModelId();
		console.log("Latest Id :"+latestId);

		//alert(serverUrl)
		    $.ajax({
		        type: "GET",
		        url: serverUrl+"/api/models/"+latestId+"/product-recommendations?user-id="+userId+"&no-of-products=20",
		        success: function(res) {
					console.log(res);
					//var obj = JSON.parse(res);
					//document.getElementById("myheading").innerHTML =  res; 
				 	//document.getElementById("nav").innerHTML =  res; 
					out = res; 
					
  			 	    getMovies(res);
  			 		//getRates();
  			 		addMovieList();
					  
		        },
		        error: function(res) {
		            var errorText = res.responseText;
		            
		        }
		    });	
	 	   	
		    function getMovies(res){

		    	$.ajax({
		        url : "movies.txt",
		        type : "GET",
		        async: false,
		        success : function(data) {
		          
		        		var lines = data.split("\n");
		        		var list =[];
		    			//Split each row using ::
		    			var j =0;
		    	   		$.each(lines, function(n, elem) {
		    	   			//console.log("enter lines");
		    			var details = elem.split("::");

		    				//alert("Element :"+details[0]);
		    				for (var i = 0,len = res.length; i < len; i++) {
		    					if(res[i]==details[0]){
		    						console.log(j);
		    						list[j] = details[1];
		    						//console.log(list[j]);
		    						//$('#nav').append('<p>'+list[j]+'</p>');
		    						j++;
		    						console.log(j);
		    					}
		    				}

		    	    	});

		    	    		//alert("list :"+list.length);
		    				console.log(list);
		    				for (var k = 0 ,l = list.length; k < l; k++) {
		    					$('#rec').append('<p>'+list[k]+'</p>');
		    					
		    			}

		        },
		        error: function() {
		           var errorText = res.responseText;
		        }
		     });

		    }

		    function addMovieList(){

		    	var movieList =[];

		    	$.ajax({
		        url : "movies.txt",
		        type : "GET",
		        async: false,
		        success : function(data) {
		          
		        		var lines = data.split("\n");
		        		var list =[];
		    			//Split each row using ::
		    			var j =0;
		    	   		$.each(lines, function(n, elem) {
		    				if(n<5) {
		    					movieList[n] = elem;
		    					console.log("Movie List :"+movieList[n]);
		    				}

		    	    	});

		        },
		        error: function() {
		           var errorText = res.responseText;
		        }
		     });

		    	console.log("get movies :"+movieList);
		    	return movieList;
		    }

		function getModelId(){
			var modelid;

			$.ajax({
		        type: "GET",
		        url: serverUrl+"/api/models",
		        async : false,
		        success: function(res) {
					console.log("models :" + res);

  			     var lastModel = res[res.length-1];
  			     if(lastModel.status=="Complete"){
  			     	modelid = lastModel.id;
  			     	console.log("Model :"+modelid);
  			     }
					        
		        },
		        error: function(res) {
		            var errorText = res.responseText;
		            
		        }
		    });	

	console.log("ModelID :"+modelid);
	return modelid;
}

	function PostDataToDas(){

			var jsonData = {"event": {"metaData": {},"correlationData": {},"payloadData": '[{"UserID": 2,"MovieID": 2,"Rating":3,"Timestamp": "data4"}]'}};
			jQuery.ajax({
			 type:"POST",
		 	 url:'http://localhost:9766/endpoints/EventReceiverMov',
		 	 contentType: "application/json",
		  	 data: jsonData,
		  	 	 success: function(res){//http://10.100.4.112:9763/REC_DEMO_UI-1/index.jag?id=5
					console.log("success");
				    },
		    		  error: function(res){
					 console.log("Error");
				    } 	 
		});
	}

	//Method to pass data to backend
	function PostData(movieId,rate){

		//var jsonData = {"event": {"metaData": {},"correlationData": {},"payloadData": '[{"UserID": 2,"MovieID": 2,"Rating":3,"Timestamp": "1452234655"}]'}};
			var jsonData = '{"UserID": "1","MovieID": "342","Rating":"3","Timestamp": "1452234655"}';
			jQuery.ajax({
			 type:"POST",
		 	 url:"http://10.100.4.112:9767/Demo-CXF-0.0.1-SNAPSHOT/rservice/data/"+userId+"/passData?movieId="+movieId+"&rate="+rate+"&timeStamp=1452234655",
		 	 contentType: "application/json",
		  	 data: jsonData,
		  	 	 success: function(res){//http://10.100.4.112:9763/REC_DEMO_UI-1/index.jag?id=5
					console.log("success");
				    },
		    		  error: function(res){
					 console.log("Error");
				    } 	 
		});

	}

	function enterRatesM1(){
	  $('input[name="rate1"]:checked').each(function() {
   				console.log("rate :" + this.value);
   					rates[0] = this.value;
   					console.log("rate arr :" + rates[0]);

				});
	  //PostDataToDas();
	  PostData(1,rates[0]);

}

	function enterRatesM2(){
		 $('input[name="rate2"]:checked').each(function() {
	   				console.log("rate2 :" + this.value);
	   					rates[1] = this.value;
					});
		 PostData(2,rates[1]);
	}

	function enterRatesM3(){
		 $('input[name="rate3"]:checked').each(function() {
	   				console.log("rate3 :" + this.value);
	   					rates[2] = this.value;
					});
		 PostData(3,rates[2]);
	}

	function enterRatesM4(){
		  $('input[name="rate4"]:checked').each(function() {
		        	rates[3] = this.value;
	   				console.log("rate4 :" + this.value);
					});
		  //PostData(4,rates[3]);
		  PostData(3426,rates[3]);

	}

	function enterRatesM5(){
		 $('input[name="rate5"]:checked').each(function() {
					 	rates[4] = this.value;
	   				console.log("rate5 :" + this.value);
					});
	}


		</script>
	</body>
</html>

